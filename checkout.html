<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function() {
      emailjs.init("your_user_id"); // Replace with your actual EmailJS user ID
    })();
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap');

    body {
      font-family: 'Quicksand', sans-serif;
      background-color: #f4f3f1;
      margin: 0;
      color: #2e2e2e;
    }

    header {
      background-color: #2f4f4f;
      color: white;
      padding: 1rem 2rem;
      text-align: center;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: bold;
    }

    nav ul {
      list-style: none;
      display: flex;
      justify-content: center;
      gap: 1rem;
      padding: 0;
      margin: 0;
      flex-wrap: wrap;
    }

    nav ul li a {
      color: white;
      text-decoration: none;
      font-weight: 600;
    }

    nav ul li a:hover {
      color: #98fb98;
    }

    h2 {
      text-align: center;
      margin: 20px 0;
    }

    .order-summary, .form-section {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .form-section h3 {
      text-align: center;
      margin-top: 20px;
      margin-bottom: 15px;
      color: #2f4f4f;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ccc;
      text-align: left;
      font-size: 14px;
    }

    th {
      background-color: #2f4f4f;
      color: white;
    }

    .total {
      text-align: right;
      font-weight: bold;
      margin-top: 10px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-family: 'Quicksand', sans-serif;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }

    button {
      background-color: #0f119e;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 15px;
      width: 100%;
      font-size: 16px;
      font-weight: bold;
    }

    button:hover {
      background-color: #6769f1;
    }

    footer {
      text-align: center;
      background-color: #2f4f4f;
      color: white;
      padding: 1rem;
      margin-top: 2rem;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .order-summary, .form-section {
        padding: 15px;
      }

      table, th, td {
        font-size: 12px;
      }

      button {
        font-size: 14px;
        padding: 10px;
      }
    }
  </style>
</head>
<body>

<header>
  <div class="logo">üåç Abstract Earth</div>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="shop.html">Products</a></li>
      <li><a href="checkout.html">Checkout</a></li>
    </ul>
  </nav>
</header>

<h2>Checkout</h2>

<!-- Order Summary -->
<div class="order-summary">
  <h3>Your Order</h3>
  <div id="orderItems"><p>Loading cart...</p></div>
  <p id="finalTotal" class="total"></p>
</div>

<!-- Form Section -->
<div class="form-section">
  <h3>Customer Details</h3>
  <form id="checkoutForm">
    <label>Name</label>
    <input type="text" id="name" required>
    <label>Surname</label>
    <input type="text" id="surname" required>
    <label>Email</label>
    <input type="email" id="email" required>
    <label>Phone Number</label>
    <input type="tel" id="phone" required>
    <label>Address</label>
    <input type="text" id="address" required>
    <label>Street Name</label>
    <input type="text" id="street" required>
    <label>Postal Code</label>
    <input type="text" id="postal" required>

    <h3>Payment Method</h3>
    <label><input type="radio" name="payment" value="EFT" checked> EFT</label><br>
    <label><input type="radio" name="payment" value="Debit Card"> Debit Card</label><br>
    <label><input type="radio" name="payment" value="Credit Card"> Credit Card</label><br><br>

    <h3>Delivery Option</h3>
    <label><input type="radio" name="delivery" value="Collect personally" data-cost="0" checked> Collect personally</label><br>
    <label><input type="radio" name="delivery" value="Direct transfer" data-cost="0"> Direct transfer (manual EFT)</label><br>
    <label><input type="radio" name="delivery" value="PAXI 3-5 days" data-cost="110"> PAXI (3‚Äì5 days ‚Äì R110)</label><br>
    <label><input type="radio" name="delivery" value="PAXI 5-7 days" data-cost="60"> PAXI (5‚Äì7 days ‚Äì R60)</label><br><br>

    <button type="submit">Place Order</button>
  </form>
</div>

<footer>
  <p>&copy; 2025 Mbalz_Creations. All rights reserved.</p>
  <p>Designed by Mbali Mahlangu</p>
</footer>

<script>
  (function() {
    emailjs.init("LTb6r9Wwm-ReLVU5r"); // Your EmailJS public key
  })();

  document.addEventListener("DOMContentLoaded", function () {
    const cart = JSON.parse(localStorage.getItem("cart")) || {};
    const orderItemsEl = document.getElementById("orderItems");
    const form = document.getElementById("checkoutForm");
    const finalTotalDisplay = document.getElementById("finalTotal");

    let total = 0;
    let deliveryCost = 0;

    // Build cart summary table
    let summaryHTML = '<table><tr><th>Item</th><th>Size</th><th>Color</th><th>Price</th><th>Qty</th><th>Subtotal</th></tr>';
    for (const id in cart) {
      const item = cart[id];
      const subtotal = item.qty * item.price;
      total += subtotal;
      summaryHTML += `
        <tr>
          <td>${item.name}</td>
          <td>${item.size || "-"}</td>
          <td>${item.color || "-"}</td>
          <td>R${item.price.toFixed(2)}</td>
          <td>${item.qty}</td>
          <td>R${subtotal.toFixed(2)}</td>
        </tr>`;
    }
    summaryHTML += '</table>';
    orderItemsEl.innerHTML = summaryHTML;

    // Update totals when delivery option changes
    const deliveryRadios = document.querySelectorAll('input[name="delivery"]');
    function updateFinalTotal() {
      const selected = document.querySelector('input[name="delivery"]:checked');
      deliveryCost = Number(selected.getAttribute("data-cost")) || 0;
      const grandTotal = total + deliveryCost;
      finalTotalDisplay.innerHTML = `<strong>Total with Delivery:</strong> R${grandTotal.toFixed(2)}`;
    }
    deliveryRadios.forEach(r => r.addEventListener("change", updateFinalTotal));
    updateFinalTotal();

    // Handle form submit
    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const name = document.getElementById("name").value.trim();
      const surname = document.getElementById("surname").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const address = document.getElementById("address").value.trim();
      const street = document.getElementById("street").value.trim();
      const postal = document.getElementById("postal").value.trim();
      const payment = document.querySelector('input[name="payment"]:checked').value;
      const delivery = document.querySelector('input[name="delivery"]:checked').value;
      const orderNumber = "AE" + Math.floor(Math.random() * 1000000);
      const grandTotal = total + deliveryCost;

      if (!name || !surname || !email || !phone || !address || !street || !postal) {
        alert("Please fill in all fields.");
        return;
      }

      // ===============================
      // Email 1: To Business Owner
      // ===============================
      const adminMessage = `
        <h3>üõí New Order Received</h3>
        <p><b>Customer:</b> ${name} ${surname}<br>
        <b>Email:</b> ${email}<br>
        <b>Phone:</b> ${phone}<br>
        <b>Address:</b> ${address}, ${street}, ${postal}</p>

        <p><b>Payment Method:</b> ${payment}<br>
        <b>Delivery Option:</b> ${delivery}<br>
        <b>Order Number:</b> ${orderNumber}</p>

        ${orderItemsEl.innerHTML}

        <p><b>Cart Total:</b> R${total.toFixed(2)}</p>
        <p><b>Delivery Fee:</b> R${deliveryCost.toFixed(2)}</p>
        <p><b>Grand Total:</b> R${grandTotal.toFixed(2)}</p>
      `;

      emailjs.send("service_h5anh9n", "template_a46p51a", {
        to_name: "Mbalenhle",
        email: "mbalenhlembali641@gmail.com",
        message: adminMessage
      });

      // ===============================
      // Email 2: To Customer
      // ===============================
      const customerMessage = `
        <h2 style="color:#3b7a57; font-family:Arial, sans-serif;">Order Confirmation üå±</h2>

        <p>Thank you for your order, <b>${name}</b>!</p>

        <p><b>Please note:</b> Your order is still <b>on hold</b> until we confirm that payment has been made.</p>

        <p><b>Our banking details are:</b><br>
        Bank: [Your Bank Name]<br>
        Account Name: [Your Account Name]<br>
        Account Number: [Your Account Number]<br>
        Branch Code: [Branch Code]</p>

        <p><b>Order Number:</b> ${orderNumber}</p>

        <p><b>This is what you have ordered:</b></p>
        ${orderItemsEl.innerHTML}

        <p><b>Cart Total:</b> R${total.toFixed(2)}</p>
        <p><b>Delivery Fee:</b> R${deliveryCost.toFixed(2)}</p>
        <p><b>Grand Total:</b> R${grandTotal.toFixed(2)}</p>

        <p>If you encounter any issues, please contact <b>081 319 8929</b> for assistance.</p>

        <p>Kind regards,<br>
        Abstract Earth</p>
      `;

      emailjs.send("service_h5anh9n", "template_a46p51a", {
        to_name: name,
        email: email,
        message: customerMessage
      }).then(() => {
        alert(`‚úÖ Order placed successfully! Your order number is ${orderNumber}`);
        localStorage.clear();
        window.location.href = "success.html";
      }).catch(error => {
        alert("‚ùå Failed to send order. Please try again.");
        console.error(error);
      });
    });
  });
</script>

</body>
</html>
